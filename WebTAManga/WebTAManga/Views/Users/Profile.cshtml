@model WebTAManga.Models.User

@{
    ViewData["Title"] = "User Profile";
}

<h2 class="text-center">Your Profile</h2>

<form method="post" enctype="multipart/form-data">
    @Html.AntiForgeryToken()

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success text-center">
            @TempData["SuccessMessage"]
        </div>
    }

    <div class="row justify-content-center">
        <div class="col-md-6">
            <!-- Username -->
            <div class="form-group">
                <label for="Username">Username</label>
                <input type="text" class="form-control" id="Username" name="Username" value="@Model.Username" required />
            </div>

            <!-- Email -->
            <div class="form-group">
                <label for="Email">Email</label>
                <input type="email" class="form-control" id="Email" name="Email" value="@Model.Email" required />
            </div>

            <!-- Avatar -->
            <div class="form-group text-center">
                <label for="Avatar">Avatar</label>
                <div class="mb-2">
                    <img src="~/uploads/avatars/@Model.Avatar" alt="Current Avatar" class="avatar-img img-fluid rounded-circle" />
                </div>
                <input type="file" class="form-control-file" id="Avatar" name="avatarFile" />
            </div>

            <!-- New Password -->
            <div class="form-group">
                <label for="Password">New Password</label>
                <input type="password" class="form-control" id="Password" name="newPassword" placeholder="Enter new password (optional)" />
            </div>

            <button type="submit" class="btn btn-primary btn-block">Update Profile</button>
        </div>
    </div>
</form>

<!-- Hiển thị cấp bậc và thanh tiến trình -->
<div class="text-center mt-3">
    <div class="progress-container">
        <span class="level-name">@ViewBag.LevelName (@(Math.Round(ViewBag.ProgressPercentage))% - Đỉnh Phong)</span>
        <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: @ViewBag.ProgressPercentage%;" aria-valuenow="@ViewBag.ProgressPercentage" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
        <p><strong>EXP:</strong> @ViewBag.ExpPoints</p>
    </div>
</div>

<!-- Form chọn Rank -->
<form method="post" asp-action="UpdateRank">
    <input type="hidden" name="userId" value="@Model.UserId" />

    <label><strong>Chọn Rank:</strong></label>
    <div>
        @foreach (var rank in ViewBag.Ranks as List<WebTAManga.Models.Rank>)
        {
            <div class="form-check">
                <input class="form-check-input" type="radio" id="rank_@rank.RankId"
                       name="selectedRankId" value="@rank.RankId"
                @(Model.RankId == rank.RankId ? "checked" : "") />
                <label class="form-check-label" for="rank_@rank.RankId">@rank.Name</label>
            </div>
        }
    </div>

    <button type="submit" class="btn btn-primary mt-2">Cập nhật Rank</button>
</form>

<style>
    .avatar-img {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ddd;
    }

    .form-control-file {
        margin-top: 10px;
    }

    .btn-block {
        margin-top: 20px;
    }

    .alert {
        margin-top: 15px;
    }

    .text-center {
        text-align: center;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .progress-container {
        margin: 20px 0;
        background-color: #1a1a1a;
        padding: 10px;
        border-radius: 5px;
    }

    .level-name {
        font-size: 16px;
        color: #fff;
        margin-bottom: 5px;
        display: block;
    }

    .progress {
        height: 20px;
        background-color: #333;
        border-radius: 10px;
        overflow: hidden;
    }

    .progress-bar {
        background: linear-gradient(to right, #00ffff, #00ff00, #ffcc00);
        transition: width 0.3s ease;
    }
</style>